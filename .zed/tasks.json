[
  {
    "label": "build (windows)",
    "command": "$bdir = \"$ZED_WORKTREE_ROOT/build/debug\"; cmake -S \"$ZED_WORKTREE_ROOT\" -B \"$bdir\" -G \"Visual Studio 17 2022\" -A x64 -DCMAKE_EXPORT_COMPILE_COMMANDS=ON; if ($LASTEXITCODE -ne 0) { exit $LASTEXITCODE }; cmake --build \"$bdir\" --config Debug; if ($LASTEXITCODE -ne 0) { exit $LASTEXITCODE }; $cc = Join-Path $bdir \"compile_commands.json\"; if (Test-Path $cc) { cmake -E copy_if_different $cc \"$ZED_WORKTREE_ROOT/compile_commands.json\" };",
    "cwd": "$ZED_WORKTREE_ROOT",
    "use_new_terminal": false,
    "allow_concurrent_runs": false,
    "reveal": "always"
  },
  {
    "label": "build and run (windows)",
    "command": "$bdir = \"$ZED_WORKTREE_ROOT/build/debug\"; cmake -S \"$ZED_WORKTREE_ROOT\" -B \"$bdir\" -G \"Visual Studio 17 2022\" -A x64 -DCMAKE_EXPORT_COMPILE_COMMANDS=ON; if ($LASTEXITCODE -ne 0) { exit $LASTEXITCODE }; cmake --build \"$bdir\" --config Debug; if ($LASTEXITCODE -ne 0) { exit $LASTEXITCODE }; $cc = Join-Path $bdir \"compile_commands.json\"; if (Test-Path $cc) { cmake -E copy_if_different $cc \"$ZED_WORKTREE_ROOT/compile_commands.json\" }; $exe = Join-Path $bdir \"Debug/greatbadbeyond.exe\"; if (-not (Test-Path $exe)) { $exe = Join-Path $bdir \"greatbadbeyond.exe\" }; if (-not (Test-Path $exe)) { Write-Error \"Debug executable not found in $bdir\"; exit 1 }; & $exe",
    "cwd": "$ZED_WORKTREE_ROOT",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
    "reveal": "always"
  },
  {
    "label": "build release (windows)",
    "command": "$bdir = \"$ZED_WORKTREE_ROOT/build/release\"; cmake -S \"$ZED_WORKTREE_ROOT\" -B \"$bdir\" -G \"Visual Studio 17 2022\" -A x64 -DCMAKE_EXPORT_COMPILE_COMMANDS=ON; if ($LASTEXITCODE -ne 0) { exit $LASTEXITCODE }; cmake --build \"$bdir\" --config Release; if ($LASTEXITCODE -ne 0) { exit $LASTEXITCODE }; $cc = Join-Path $bdir \"compile_commands.json\"; if (Test-Path $cc) { cmake -E copy_if_different $cc \"$ZED_WORKTREE_ROOT/compile_commands.json\" };",
    "cwd": "$ZED_WORKTREE_ROOT",
    "use_new_terminal": false,
    "allow_concurrent_runs": false,
    "reveal": "always"
  },
  {
    "label": "build and run release (windows)",
    "command": "$ErrorActionPreference = 'Stop';\n$bdir = \"$ZED_WORKTREE_ROOT/build/release\";\ncmake -S \"$ZED_WORKTREE_ROOT\" -B \"$bdir\" -G \"Visual Studio 17 2022\" -A x64 -DCMAKE_EXPORT_COMPILE_COMMANDS=ON;\nif ($LASTEXITCODE -ne 0) { exit $LASTEXITCODE }\ncmake --build \"$bdir\" --config Release;\nif ($LASTEXITCODE -ne 0) { exit $LASTEXITCODE }\n$cc = Join-Path $bdir \"compile_commands.json\";\nif (Test-Path $cc) { cmake -E copy_if_different $cc \"$ZED_WORKTREE_ROOT/compile_commands.json\" };\n$exeCandidates = @(\n    (Join-Path $bdir \"Release/greatbadbeyond.exe\"),\n    (Join-Path $bdir \"greatbadbeyond.exe\"),\n    (Join-Path $bdir \"Debug/greatbadbeyond.exe\"),\n    (Join-Path $bdir \"RelWithDebInfo/greatbadbeyond.exe\"),\n    (Join-Path $bdir \"MinSizeRel/greatbadbeyond.exe\")\n);\n$exe = $exeCandidates | Where-Object { Test-Path $_ } | Select-Object -First 1;\nif (-not $exe) { Write-Error \"Release executable not found in $bdir\"; exit 1 };\nWrite-Host \"Running: $exe\";\n& $exe",
    "cwd": "$ZED_WORKTREE_ROOT",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
    "reveal": "always"
  },
  {
    "label": "build (macOS)",
    "command": "cmake -S \"$ZED_WORKTREE_ROOT\" -B \"$ZED_WORKTREE_ROOT/build/debug\" -G \"Unix Makefiles\" -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON && cmake --build \"$ZED_WORKTREE_ROOT/build/debug\" && cmake -E copy_if_different \"$ZED_WORKTREE_ROOT/build/debug/compile_commands.json\" \"$ZED_WORKTREE_ROOT/compile_commands.json\"",
    "cwd": "$ZED_WORKTREE_ROOT",
    "use_new_terminal": false,
    "allow_concurrent_runs": false,
    "reveal": "always"
  },
  {
    "label": "build and run (macOS)",
    "command": "cmake -S \"$ZED_WORKTREE_ROOT\" -B \"$ZED_WORKTREE_ROOT/build/debug\" -G \"Unix Makefiles\" -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON && cmake --build \"$ZED_WORKTREE_ROOT/build/debug\" && cmake -E copy_if_different \"$ZED_WORKTREE_ROOT/build/debug/compile_commands.json\" \"$ZED_WORKTREE_ROOT/compile_commands.json\" && \"$ZED_WORKTREE_ROOT/build/debug/greatbadbeyond\"",
    "cwd": "$ZED_WORKTREE_ROOT",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
    "reveal": "always"
  },
  {
    "label": "build release (macOS)",
    "command": "cmake -S \"$ZED_WORKTREE_ROOT\" -B \"$ZED_WORKTREE_ROOT/build/release\" -G \"Unix Makefiles\" -DCMAKE_BUILD_TYPE=Release -DCMAKE_EXPORT_COMPILE_COMMANDS=ON && cmake --build \"$ZED_WORKTREE_ROOT/build/release\" && cmake -E copy_if_different \"$ZED_WORKTREE_ROOT/build/release/compile_commands.json\" \"$ZED_WORKTREE_ROOT/compile_commands.json\"",
    "cwd": "$ZED_WORKTREE_ROOT",
    "use_new_terminal": false,
    "allow_concurrent_runs": false,
    "reveal": "always"
  },
  {
    "label": "build and run release (macOS)",
    "command": "cmake -S \"$ZED_WORKTREE_ROOT\" -B \"$ZED_WORKTREE_ROOT/build/release\" -G \"Unix Makefiles\" -DCMAKE_BUILD_TYPE=Release -DCMAKE_EXPORT_COMPILE_COMMANDS=ON && cmake --build \"$ZED_WORKTREE_ROOT/build/release\" && cmake -E copy_if_different \"$ZED_WORKTREE_ROOT/build/release/compile_commands.json\" \"$ZED_WORKTREE_ROOT/compile_commands.json\" && \"$ZED_WORKTREE_ROOT/build/release/greatbadbeyond\"",
    "cwd": "$ZED_WORKTREE_ROOT",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
    "reveal": "always"
  }
]
